diff -ur net-snmp-5.3.org/configure.in net-snmp-5.3/configure.in
--- net-snmp-5.3.org/configure.in	2005-12-28 18:20:56.000000000 +0100
+++ net-snmp-5.3/configure.in	2006-01-09 01:07:39.031490000 +0100
@@ -1704,11 +1704,11 @@
   if test "x$sec" = "xksm" -a "xyes" = "x$already_checked_krb5"; then
     continue
   fi
-  already_checked_krb5=yes
 
   if test x$sec != xksm; then
     rebuilt_new_with_security="$rebuilt_new_with_security $sec"
   else
+    already_checked_krb5=yes
     if test no = $trykrb5; then
       AC_MSG_NOTICE([configured not to use krb5. disabling ksm])
       continue
@@ -2661,23 +2661,6 @@
     LIBS="${LIBS} -ladm"
     AGENTLIBS="${AGENTLIBS} -ladm"))
 
-case $target_os in
-    aix*) # AIX perfstat library, needed for CPU/memory statistics
-        AC_CHECK_HEADERS(libperfstat.h,
-            AC_CHECK_LIB(perfstat, perfstat_cpu_total, AC_DEFINE(HAVE_PERFSTAT)
-            AGENTLIBS="${AGENTLIBS} -lperfstat"), AC_MSG_ERROR([
-
-*** To monitor CPU/memory values in AIX you need to install
-*** libperfstat which can be found in bos.perf
-]))
-        ;;
-    hpux*) # HP-UX agent needs open_mib
-        AC_CHECK_LIB(nm, open_mib, AC_DEFINE(HAVE_LIBNM)
-            AGENTLIBS="${AGENTLIBS} -lnm")
-        ;;
-    *)
-        ;;
-esac
 # WIN32
 # (mingw32 must link winsock explicitly)
 AC_CHECK_HEADERS(winsock.h,[
@@ -2880,7 +2863,7 @@
 
 AC_MSG_RESULT([$ac_cv_type_ssize_t])
 if test $ac_cv_type_ssize_t = yes; then
-  AC_DEFINE(HAVE_SSIZE_T)
+  AC_DEFINE(HAVE_SSIZE_T,,[have ssize_t])
 fi
 
 # Check ps args
--- net-snmp-5.4/agent/mibgroup/Makefile.in.orig	2006-09-13 19:00:27.000000000 +0200
+++ net-snmp-5.4/agent/mibgroup/Makefile.in	2006-12-02 11:51:38.369040000 +0100
@@ -22,9 +22,13 @@
 .c.o:
 	$(CC) -c $(CPPFLAGS) $(CFLAGS) -o $@ $<
 
-OBJS  = @mib_module_list_o@
-LOBJS = @mib_module_list_lo@
-SRCS  = @mib_module_list_c@
+@mib_module_list_o@
+@mib_module_list_lo@
+@mib_module_list_c@
+
+OBJS  = $(mib_module_list_o)
+LOBJS = $(mib_module_list_lo)
+SRCS  = $(mib_module_list_c)
 
 all: standardall $(LOBJS)
 
--- net-snmp-5.4/agent/mibgroup/ucd-snmp/disk.c.orig	2006-09-15 02:48:41.000000000 +0200
+++ net-snmp-5.4/agent/mibgroup/ucd-snmp/disk.c	2006-12-02 12:03:27.889382250 +0100
@@ -229,7 +229,7 @@
 static void 
 disk_parse_config(const char *token, char *cptr)
 {
-#if HAVE_FSTAB_H || HAVE_GETMNTENT || HAVE_STATFS
+#if HAVE_FSTAB_H || defined(HAVE_GETMNTENT) || HAVE_STATFS
   char            tmpbuf[1024];
   char            path[STRMAX];
   int             minpercent;
@@ -296,7 +296,7 @@
 static void 
 disk_parse_config_all(const char *token, char *cptr)
 {
-#if HAVE_FSTAB_H || HAVE_GETMNTENT || HAVE_STATFS
+#if HAVE_FSTAB_H || defined(HAVE_GETMNTENT) || HAVE_STATFS
   char            tmpbuf[1024];
   int             minpercent = DISKMINPERCENT;
     
@@ -428,7 +428,7 @@
 static void 
 find_and_add_allDisks(int minpercent)
 {
-#if HAVE_GETMNTENT
+#if defined(HAVE_GETMNTENT)
 #if HAVE_SYS_MNTTAB_H
   struct mnttab   mnttab;
 #else
@@ -451,8 +451,8 @@
    * string declared above and at the end of the routine return it
    * to the caller 
    */
-#if HAVE_FSTAB_H || HAVE_GETMNTENT || HAVE_STATFS   
-#if HAVE_GETMNTENT
+#if HAVE_FSTAB_H || defined(HAVE_GETMNTENT) || HAVE_STATFS   
+#if defined(HAVE_GETMNTENT)
 #if HAVE_SETMNTENT
   mntfp = setmntent(ETC_MNTTAB, "r");
   while (NULL != (mntent = getmntent(mntfp))) {
@@ -522,7 +522,7 @@
 static char *
 find_device(char *path)
 {
-#if HAVE_GETMNTENT
+#if defined(HAVE_GETMNTENT)
 #if HAVE_SYS_MNTTAB_H
   struct mnttab   mnttab;
 #else
@@ -548,8 +548,8 @@
    * string declared above and at the end of the routine return it
    * to the caller 
    */
-#if HAVE_FSTAB_H || HAVE_GETMNTENT || HAVE_STATFS   
-#if HAVE_GETMNTENT
+#if HAVE_FSTAB_H || defined(HAVE_GETMNTENT) || HAVE_STATFS   
+#if defined(HAVE_GETMNTENT)
 #if HAVE_SETMNTENT
   mntfp = setmntent(ETC_MNTTAB, "r");
   while (NULL != (mntent = getmntent(mntfp)))
